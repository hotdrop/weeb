# 1. Weeb
Chrome / Google アカウント側の Discover をできるだけ汚さないようにするため、趣味のネットサーフィンはこの専用アプリで行う。
Chrome とは独立した Cookie / キャッシュを持つ WebView ベースの簡易ブラウザを提供する。

# 2. 対象環境・技術スタック
- 言語: Kotlin
- UI: Jetpack Compose
- 永続化: Room

# 3. 画面構成
- メイン画面
- ブックマーク画面(登録・表示・編集)

# 4. メイン画面仕様
- アプリ起動したらメイン画面を表示する。
- メイン画面はWebViewで構築する。ホームURLをロードする。
    - ホームURL: `https://www.google.com/`

## 4.1 画面構成
- 上部：アプリバー
    - 左：戻るボタン
    - 中央：URL / 検索バー（テキストフィールド）
        - URL 形式であればそのまま遷移
        - それ以外の文字列はデフォルト検索エンジンで検索（後述）
    - 右端付近：以下のアイコンを配置
        - ホームボタン（Home に戻る）
        - ブックマーク登録
        - メニュー
            - ブックマーク一覧への遷移
            - モバイル/PC モード切替トグル
        - →アプリバーが詰まる恐れもあるためFloatingActionButtonでも良い
- 中央：WebView（Compose から `AndroidView` でホスト）

## 4.2 WebViewの仕様
「Chrome とは完全に独立したキャッシュを持つ」ことが、今回のサンドボックス用途にはメリットです。
1. WebView を毎回作り直さない
    1. Compose で都度 `WebView()` を新規生成していると、セッション状態（キャッシュ・履歴・Cookie など）もプロセス内で分散しがちです。実装としては「Activity/画面内で 1 つの WebView インスタンスを保持して、Compose から AndroidView(factory = { existingWebView }) でそれをホストする」構成の方が安定します。
2. clearCache(true) / clearHistory() を不用意に呼ばない
    1. 再表示時に「毎回クリア」なんてことをやってしまうと当然キャッシュは効きません。
3. DOM Storage / localStorage を有効にする
    1. `settings.domStorageEnabled = true`
    2. これ自体は HTTP キャッシュとは別レイヤーですが、サイト側の「オフライン・ローカルな保持機構」を殺さない、という意味で UX は良くなります。

## 4.3 検索バー動作
- ユーザーが入力した文字列を解析:
    - 「`http://` or `https://` で始まる」「`.` を含む」などの簡易判定で URL とみなせる場合は、その URL へ `loadUrl`。
    - それ以外は検索クエリとして、デフォルト検索エンジンのクエリ URL にエンコードして遷移。
        - Google の場合例：`https://www.google.com/search?q=<encoded>`

# 5. ブックマーク機能仕様
ブックマークはカテゴリごとに登録でき、タイトルと現在表示しているURLを保持する。

## 5.1 データモデル
- Category
    - `id`: Long or String（内部ID）
    - `name`: String（カテゴリ名、ユーザー入力）
- Bookmark
    - `id`: Long or String
    - `categoryId`: Category.id への参照
    - `title`: String（ユーザーが任意編集可。登録時は WebView のタイトルを初期値に使用）
    - `url`: String

## 5.2 ブックマーク登録フロー
- ブックマーク登録アイコンをタップすると、登録ダイアログを表示する。
- 押下時の挙動：
    1. 現在のページ URL・タイトルを取得
    2. ダイアログ or シートで以下を表示:
        1. タイトル（編集可能、初期値は WebView の `title`）
        2. URL（編集不可）
        3. カテゴリ選択（必須）
            1. 既存カテゴリをリスト表示し、選択可能。
            2. 「新規カテゴリ作成」ボタンも用意する。
    3. 保存ボタンで Bookmark を作成し永続化。
- 備考
    - 同じURLが登録されていたら「すでに登録されている」というメッセージをダイアログの上に赤文字で表示し、登録ボタンを非活性にする

## 5.3 ブックマーク一覧画面
- アプリバーのメニューボタンから遷移する「ブックマーク一覧画面」を用意。
- 構成：
    - カテゴリ単位にセクション表示。
    - 各カテゴリごとに、登録されたブックマークのリストを表示。
- 動作：
    - ブックマークタップ → メイン画面に戻り、その URL を WebView にロード。
    - 長押し or アイコンから編集メニュー表示：
        - タイトル編集
        - カテゴリ変更
        - 削除
- カテゴリ自体の編集：
    - カテゴリ名変更
    - カテゴリ削除（そのカテゴリ配下のブックマークも削除）

# 6. モバイル / PC モード切替仕様
## 6.1 概要
- アプリバー上に「モバイル / PC」トグルボタンを配置。
- トグル状態はアプリ内で記憶する（起動し直しても最後の状態を維持）。

## 6.2 WebView 設定
- モバイルモード：
    - WebView デフォルトの User-Agent を使用。
- PC モード：
    - User-Agent を PC ブラウザ相当の文字列に変更。
        - 例：Chrome on Windows / macOS の UA をベースにする。
    - `useWideViewPort = true` / `loadWithOverviewMode = true` など、PC サイトが見やすいように設定。

## 6.3 切り替え時の挙動
- モード切り替え時：
    - 現在表示中のページを再ロード（`reload`）。
    - 可能であれば、現在の URL を保持したまま再読み込みする。
- 注意：
    - サイトによっては UA を変えてもレイアウトが大きく変わらない場合がある（これは仕様とする）。

# 7. ズーム仕様
- WebSettings にてピンチズームを有効化。
    - `setSupportZoom(true)` など。
- 内部スクロール／ズーム挙動は WebView デフォルトのものに任せる。

# 8. セキュリティ・プライバシー仕様
- JavaScript ブリッジ
    - `addJavascriptInterface` は一切使用しない
    - Web ページからアプリ内部の API を呼び出せないようにする。
- 外部スキーム・インテント URL
    - スキームは`http`, `https`のみ。`tel:`, `mailto:`, `intent://` など、HTTP/HTTPS 以外のスキームを開こうとした場合、何もしない
    - ファイルダウンロードはサポートしない（リンクタップしても何もしない）

# 9. 挙動の細部・エッジケース
- バックキー（端末の戻るボタン）：
    - WebView の内部履歴があれば `goBack()`。
    - それ以上戻れない場合は Activity を終了する。
- HTTPS エラーや証明書エラー：
    - エラー時はページ表示しない
